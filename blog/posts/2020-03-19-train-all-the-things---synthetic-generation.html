<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train All the Things — Synthetic Generation - burningdaylight</title>

    <meta name="description" content="Various notes and ideas.">
    <meta name="author" content="Alexander Hagerman">

    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://burningdaylight.io/feed.xml">
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="https://burningdaylight.io/atom.xml">    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/portfolio.css">
    <link rel="stylesheet" href="/static/css/resume.css">

    <link rel="icon" type="image/x-icon" href="/static/icons/favicon.ico">

    
</head>
<body>
    <header>
        <nav>
            <a href="/">Home</a>
            <a href="/blog/">Blog</a>
            <a href="/programming/portfolio/">Portfolio</a>
            <a href="/programming/resume/">Resume</a>
            <a href="/lists/books/">Books</a>
            <a href="/lists/podcast/">Podcast</a>
            <a href="/lists/links/">Links</a>
        </nav>
    </header>

    <main>
        
<article class="post">
    <header>
        <h1>Train All the Things — Synthetic Generation</h1>
        
        <time datetime="2020-03-19">
            March 19, 2020
        </time>
        

        
        <div class="tags">
            Tags:
            
            <a href="/tags/python/">python</a>
            
            <a href="/tags/bash/">bash</a>
            
            <a href="/tags/programming/">programming</a>
            
            <a href="/tags/hackaday/">hackaday</a>
            
        </div>
        

        
        <div class="categories">
            Categories:
            
            <a href="/categories/programming/">programming</a>
            
        </div>
        
    </header>

    <div class="content">
        <p>After getting the display and worker up and running I started down the path of training my model for keyword
recognition. Right now I’ve settled on the wake words Hi Smalltalk. After the wake word is detected the model will then
detect silence, on, off, or unknown.</p>
<p>My starting point for training the model was
the <a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/lite/micro/examples/micro_speech">microspeech</a>
and <a href="https://github.com/tensorflow/docs/blob/master/site/en/r1/tutorials/sequences/audio_recognition">speechcommands</a>
tutorials that are part of the Tensorflow project. One of the first things I noticed while planning out this step was
the lack of good wake words in the speech command dataset. There
are <a href="https://github.com/jim-schwoebel/voice_datasets">many</a> voice datasets available online, but many are unlabeled or
conversational. Since digging didn't turn up much in the way of open labeled word datasets I decided to use on and off
from the speech commands <a href="https://ai.googleblog.com/2017/08/launching-speech-commands-dataset.html">dataset</a> since that
gave me a baseline for comparison with my custom words. After recording myself saying hi and smalltalk less then ten
times I knew I did not want to generate my own samples at the scale of the other labeled keywords.</p>
<p>Instead of giving up on my wake word combination I started digging around for options and found an
interesting <a href="https://github.com/JohannesBuchner/spoken-command-recognition">project</a> where somebody had started down the
path of generating labeled words with text to speech. After reading through the repo I ended up
using <a href="http://espeak.sourceforge.net/">espeak</a> and <a href="http://sox.sourceforge.net/">sox</a> to generate my labeled dataset.</p>
<p>The first step was to generate the <a href="https://en.wikipedia.org/wiki/Phoneme">phonemes</a> for the wake words:</p>
<p>
<pre><code class="language-shell">$ espeak -v en -X smalltalk
</code></pre>
</p>
<p>then stored the phoneme in a word file that will be used by generate.sh.</p>
<p>
<pre><code class="language-shell">$ cat words
hi 001
busy 002
free 003
smalltalk 004
</code></pre>
</p>
<p>After modifying generate.sh from the spoken command repo (eliminating some extra commands and extending the loop to
generating more samples) I had everything I needed to synthetically generate a new labeled word dataset.</p>
<p>
<pre><code class="language-bash">#!/bin/bash
# For the various loops the variable stored in the index variable
# is used to attenuate the voices being created from espeak.*lastwordid=&quot;&quot;cat words | while read word wordid phonemedo
echo $word
mkdir -p db/$word

if [[ $word != $lastword ]]; then
 versionid=0
 fi

lastword=$word

# Generate voices with various dialects
for i in english english-north en-scottish englishrp englishwmids english-us en-westindies
do
    # Loop changing the pitch in each iteration
    for k in $(seq 1 99); do
        # Change the speed of words per minute
        for j in 80 100 120 140 160; do
            echo $versionid &quot;$phoneme&quot; $i $j $k
            echo &quot;$phoneme&quot; | espeak -p $k -s $j -v $i -w db/$word/$versionid.wav
            # Set sox options for Tensorflow
            sox db/$word/$versionid.wav -b 16 --endian little db/$word/tf$versionid.wav rate 16k
            ((versionid++))
        done
     done
done
</code></pre>
</p>
<p>After the run I have samples and labels with a volume comparable to the other words provided by Google. The pitch, speed
and tone of voice changes with each loop which will hopefully provide enough variety to make this dataset useful in
training. Even if this doesn’t work out learning about espeak and sox was interesting. I've already got some future
ideas on how to use those. If it does work the ability to generate training data on demand seems incredibly useful.</p>
<p>Next up, training the model and loading to the ESP-EYE. The code, docs, images etc for the project can be
found <a href="https://github.com/n0mn0m/on-air">here</a> and I’ll be posting updates as I continue along
to <a href="https://hackaday.io/project/170228-on-air">HackadayIO</a> and this blog. If you have any questions or ideas
reach <a href="mailto:alexander.hagerman@icloud.com">out</a>.</p>
    </div>
</article>

    </main>

    <footer>
        <p>&copy; 2025 <a href="/me/">Alexander Hagerman</a>. All rights reserved.</p>
        <p>
            <a href="/feed.xml">RSS</a> |
            <a href="/atom.xml">Atom</a>
        </p>
    </footer>

    
    <script src="/static/javascripts/mathjax.js"></script>
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
    
</body>
</html>