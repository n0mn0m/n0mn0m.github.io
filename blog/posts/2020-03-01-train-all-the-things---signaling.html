<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train All the Things — Signaling - burningdaylight</title>

    <meta name="description" content="Various notes and ideas.">
    <meta name="author" content="Alexander Hagerman">

    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://burningdaylight.io/feed.xml">
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="https://burningdaylight.io/atom.xml">    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/portfolio.css">
    <link rel="stylesheet" href="/static/css/resume.css">

    <link rel="icon" type="image/x-icon" href="/static/icons/favicon.ico">

    
</head>
<body>
    <header>
        <nav>
            <a href="/">Home</a>
            <a href="/blog/">Blog</a>
            <a href="/programming/portfolio/">Portfolio</a>
            <a href="/programming/resume/">Resume</a>
            <a href="/lists/books/">Books</a>
            <a href="/lists/podcast/">Podcast</a>
            <a href="/lists/links/">Links</a>
        </nav>
    </header>

    <main>
        
<article class="post">
    <header>
        <h1>Train All the Things — Signaling</h1>
        
        <time datetime="2020-03-01">
            March 01, 2020
        </time>
        

        
        <div class="tags">
            Tags:
            
            <a href="/tags/javascript/">javascript</a>
            
            <a href="/tags/hackaday/">hackaday</a>
            
        </div>
        

        
        <div class="categories">
            Categories:
            
            <a href="/categories/programming/">programming</a>
            
        </div>
        
    </header>

    <div class="content">
        <p>After <a href="https://burningdaylight.io/posts/train-all-the-things-planning/">figuring out</a> what I was going to use for my
project I started work with things I know. I already had some experience with Cloudflare workers building
a <a href="https://burningdaylight.io/posts/system-status-observer/">home system status</a> page, and Workers K/V makes storing and
fetching data quick and easy. I ended up with a simple endpoint that I POST to set a bit after keyword detection, and
the PyPortal retrieves that status to determine what to display:</p>
<p>
<pre><code class="language-javascript">const setCache = (key, data) =&gt; SIGNALS.put(key, data);
const getCache = key =&gt; SIGNALS.get(key);async function getStatus(cacheKey) {
 var serviceStat = await getCache(cacheKey); if (!serviceStat) {
  return new Response('invalid status key', { status: 500 });
 } else {
  return new Response(serviceStat, {status: 200});
 }
}

async function setStatus(cacheKey, cacheValue) {
 try {
  await setCache(cacheKey, cacheValue);
  return new Response((cacheKey + &quot; set to &quot; + cacheValue + &quot;\n&quot;), { status: 200 });
 } catch (err) {
  return new Response(err, { status: 500 });
 }
}

async function handleRequest(request) {
  var psk = await getCache(&quot;PSK&quot;)
  let presharedKey = new URL(request.url).searchParams.get('psk');
  let statusKey = new URL(request.url).searchParams.get('service');
  let statusValue = new URL(request.url).searchParams.get('status'); if (presharedKey === psk) {
  if (request.method === 'POST') {
   return setStatus(statusKey, statusValue);
  } else if (request.method === 'GET' &amp;&amp; statusKey) {
   return getStatus(statusKey);
  } else {
   return new Response(&quot;\n&quot;, { status: 418 });
  }
  } else {
   return new Response(&quot;Hello&quot;)
  }
}

addEventListener('fetch', event =&gt; {
 event.respondWith(handleRequest(event.request))
})
</code></pre>
</p>
<p>Nothing tricky happening above, just checking the request, and calling the appropriate function to store or fetch the
status bit. With the function deployed to my Cloudflare Worker and verified with some GET and POST calls I was ready to
move on to the <a href="https://burningdaylight.io/posts/train-all-the-things-display/">display</a>.</p>
<p>The code, docs, images etc for the project can be found <a href="https://github.com/n0mn0m/on-air">here</a> and I’ll be posting
updates as I continue along to <a href="https://hackaday.io/project/170228-on-air">HackadayIO</a> and this blog. If you have any
questions or ideas reach <a href="mailto:alexander.hagerman@icloud.com">out</a>.</p>
    </div>
</article>

    </main>

    <footer>
        <p>&copy; 2025 <a href="/me/">Alexander Hagerman</a>. All rights reserved.</p>
        <p>
            <a href="/feed.xml">RSS</a> |
            <a href="/atom.xml">Atom</a>
        </p>
    </footer>

    
    <script src="/static/javascripts/mathjax.js"></script>
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>
    
</body>
</html>